<!doctype html><html lang=ru dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>Project configuration. Part 1. Railsclub intro. &#183; Андрей Куманяев</title><meta name=title content="Project configuration. Part 1. Railsclub intro. &#183; Андрей Куманяев"><script type=text/javascript src=https://zzet.org/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=https://zzet.org/css/main.bundle.min.100caa677b4bc416cdd884107b203b4869f9b413a19aa57d12069fb826f1abe9.css integrity="sha256-EAyqZ3tLxBbN2IQQeyA7SGn5tBOhmqV9EgafuCbxq+k="><meta name=description content="
      
        
      
    "><meta name=keywords content="ruby,ruby,on,rails,configuration,monilith,microservice"><meta name=robots content="all"><link rel=canonical href=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/"><meta property="og:site_name" content="Андрей Куманяев"><meta property="og:title" content="Project configuration. Part 1. Railsclub intro."><meta property="og:locale" content="ru"><meta property="og:type" content="article"><meta property="article:section" content="archive"><meta property="article:published_time" content="2017-10-29T00:00:00+00:00"><meta property="article:modified_time" content="2017-10-29T00:00:00+00:00"><meta property="article:tag" content="Configuration"><meta property="article:tag" content="Conference"><meta property="article:tag" content="Railsclub 2017"><meta name=twitter:card content="summary"><meta name=twitter:title content="Project configuration. Part 1. Railsclub intro."><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"","name":"Project configuration. Part 1. Railsclub intro.","headline":"Project configuration. Part 1. Railsclub intro.","inLanguage":"ru","url":"https:\/\/zzet.org\/ru\/archive\/2017-10-29-project-configuration-railsclub-intro\/","author":{"@type":"Person","name":"Андрей Куманяев"},"copyrightYear":"2017","dateCreated":"2017-10-29T00:00:00\u002b00:00","datePublished":"2017-10-29T00:00:00\u002b00:00","dateModified":"2017-10-29T00:00:00\u002b00:00","keywords":["ruby,ruby","on","rails,configuration,monilith,microservice"],"mainEntityOfPage":"true","wordCount":"4650"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://zzet.org/ru/","name":"Андрей Куманяев","position":1},{"@type":"ListItem","item":"https://zzet.org/ru/archive/","name":"","position":2},{"@type":"ListItem","name":"Project Configuration. Part 1. Railsclub Intro.","position":3}]}</script><meta name=author content="Андрей Куманяев"><link href=https://twitter.com/username rel=me><link href=https://github.com/zzet rel=me><link href=https://x.com/zzetorg rel=me><link href=https://www.reddit.com/user/zzet/ rel=me><link href=https://www.linkedin.com/in/andrey-kumanyaev/ rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-VGXR3BQCTQ"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VGXR3BQCTQ")}</script></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Перейти к содержанию</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/ru/>Андрей Куманяев</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/ru/about/ title="Обо мне"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Обо мне</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/ru/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Блог</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=https://github.com/zzet title target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=https://x.com/zzetorg title target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=https://zzet.org/ru/>Андрей Куманяев</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=https://zzet.org/ru/archive/>archive</a><span class="px-1 text-primary-500">/</span></li><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/>Project configuration. Part 1. Railsclub intro.</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Project configuration. Part 1. Railsclub intro.</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2017-10-29 00:00:00 +0000 UTC">29 октября 2017 г.</time><span class="px-2 text-primary-500">&#183;</span><span title="Время чтения">22 минуты</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/zzet.github.com/content/archive/2017-10-29-project-configuration-railsclub-intro.ru.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title=Редактировать><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M490.3 40.4c21.9 21.87 21.9 57.33.0 79.2l-30 30.1-98-97.98 30.1-30.06C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7 339.7 74.34l98 97.96L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2l-88.8 29.6C150.1 385.6 141.5 383.4 135 376.1 128.6 370.5 126.4 361 129.2 352.4l29.6-88.8C161.6 255.3 166.2 247.8 172.4 241.7v0zM192 63.1c17.7.0 32 15.23 32 32 0 18.6-14.3 32-32 32H96c-17.67.0-32 15.2-32 32V416c0 17.7 14.33 32 32 32H352c17.7.0 32-14.3 32-32V319.1c0-16.8 14.3-32 32-32s32 15.2 32 32V416c0 53-43 96-96 96H96c-53.02.0-96-43-96-96V159.1c0-53 42.98-96 96-96h96z"/></svg></span></a></span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="min-h-0 min-w-0 max-w-prose grow"><p>Данная статья является изначально была транскриптом к докладу на конференции Railsclub 2017. По итогам конференции в текст были внесены незначительные исправления.</p><p>В процессе чтения вы поймете, почему нет смысла сразу описывать все детали в мельчайших подробностях. Я не снимаю с себя ответственности в вопросе предоставления интересующей информации. Вы можете написать в комментариях, какие вопросы у вас возникли и что стоит подробнее изложить. Это послужит триггером для детальных публикаций.</p><p>Поехали.</p><p>Сегодня я хочу поговорить по поводу темы, которая может показаться окружающим старой, избитой и не интересной. Но все, на самом деле не так. Как говорится, все новое, это хорошо забытое старое, особенное если старое <strong>должно</strong> быть обновлено. Я думаю, что вы слышали о том, что все доклады делятся на 2 типа: похвастаться или исповедаться. Сегодня я буду делать второе (наверное).</p><p>В процессе подготовки к докладу, я думал как лучше начать повествование&mldr; Придумал слезливую историю про свой опыт борьбы с воздушными замками, нашел пугающие картинки&mldr; А потом зашел на википедию и&mldr; нашел ответ на вопрос, который хочу раскрыть.</p><blockquote><p>Конфигурация программного обеспечения — совокупность настроек программы, задаваемая пользователем, <strong>а также процесс изменения этих настроек в соответствии с нуждами пользователя</strong>.</p></blockquote><p>Проблема в том, что большинство смотрит только на первую часть этого определения, и (очень часто) не берут во внимание вторую часть. Конечно, проблема не только в этом, ключевые аспекты мы рассмотрим, но именно этот вопрос сподвиг меня пересмотреть свои взгляды на тему конфигурации проектов и выработать новый подход. И вопрос не только в том, как обновлять конфигурацию в прямом смысле этого слова. Нет, я не буду говорить о том, как нужно нажимать на клавиши, для того, чтобы породить код. Я хочу затронуть проблему внесения изменений в конфигурацию, доставку этих изменений до продакшена и работой в разных окружениях с одним и том же кодом. Вот об этом я и поговорю с вами сегодня. И да, разговор будет в контексте ruby, конечно (но можно транслировать на другие языки и технологии) :)</p><p>Начну я с небольшого лирического отступления. Вот тут многие говорят, что Ruby умер, что он не развивается, что мир тлен и надо валить. Так получилось, что за последние 3 года я увидел ряд совершенно разных проектов. Разных не только в плане предметной области, но и в плане архитектуры. Это были и монолиты, и полу-монолиты, и полу-полу-монолиты, и проекты на микросервисной архитектуре. И проекты на MRI, и на JRuby, и примеси на других языках. Зоопарк, одним словом.
Так вот, в каждом из этих проектов применялись разные подходы к конфигурации этих проектов. Подходы были разные, проблемы тоже были разные. Но все эти <em>проблемы</em> сводились к одному и тому же слову: <strong>конфигурация</strong>.
Так получилось, что при участии в одном проекте у меня просто начало, как говорится, пригорать. Компетентность и профессионализм парней в команде не вызывали никаких вопросов, но вот подходы и определенные решения&mldr; я долго не мог понять, почему принимались именно такие решения, но видел что они ведут в никуда. А потом понял. Проблема была на поверхности: <strong>К чему привыкли - то и исповедуем</strong>. Поэтому вопрос <strong>Привычки</strong> рассмотрю в первую очередь.
Когда мы говорили с организаторами конференции Railsclub по поводу этого доклада, я им отправил вот это <a href="https://www.youtube.com/watch?v=FeCXooh8AXE" target=_blank rel=noreferrer>видео</a>. С тех пор прошло достаточно количество времени, чтобы я смог подобрать политкорректные слова, систематизировать свою ненависть и спокойно все изложить.</p><h1 id=сonvention-over-сonfiguration class="relative group">Сonvention over Сonfiguration <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d1%81onvention-over-%d1%81onfiguration aria-label=Якорь>#</a></span></h1><p>Самое смешное в этой истории то, что экосистема rails построена на соглашениях, а именно вопрос конфигурации не подчиняется этому правилу и в этом вопросе кто во что горазд. Да, это просто такой вот парадокс. У нас будут соглашения, чтобы не было тонны конфигураций, но от конфигурации все равно не уйти.</p><p>Если кто не знает, Сonvention over Сonfiguration — это принцип построения фреймворков и библиотек, призванный сократить количество требуемой конфигурации без потери гибкости. Обычно переводится как «соглашения по конфигурации». В строгой форме этот принцип можно выразить так: аспект программной системы нуждается в конфигурации тогда и только тогда, когда этот аспект НЕ удовлетворяет некоторой спецификации. Принцип работает когда речь идет о маппинге классов на какие-либо ресурсы (таблицы базы данных, события, ресурсы файловой системы). Согласно принципу, если класс соответствует соглашению наименования, тогда он не нуждается в дополнительной конфигурации. В этом контексте название принципа можно перевести как «Соглашение НАД конфигурацией», такой перевод указывает на первостепенность соглашения, а не конфигурации.</p><p>Классический пример CoC принципа — Hibernate. В Hibernate правила объектно-реляционного меппинга можно описывать с помощью XML-файлов:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;class</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Tag&#34;</span> <span style=color:#a6e22e>table=</span><span style=color:#e6db74>&#34;tag&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Name&#34;</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Value&#34;</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;value&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Value2&#34;</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;value2&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Value3&#34;</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;value3&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/class&gt;</span>
</span></span></code></pre></div><p>Как видно, здесь имеются повторения свойств класса и колонок таблицы. Если ввести соглашение о том, что по умолчанию колонки таблицы должны назаваться также как свойство, то можно опустить часть конфигурации:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;class</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Tag&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Name&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Value&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Value2&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Value3&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/class&gt;</span>
</span></span></code></pre></div><p>Однако, если какое-то свойство потребуется сохранить в колонку с отличным именем, это придется указать явно. В этом и состоит суть принципа.</p><p>Наибольшее применение принцип CoC находит в среде Ruby on Rails. Это в принципе понятно, если учесть, что RoR ориентирована на быструю разработку, а CoC позволяет свести конфигурацию к минимуму.</p><p>И так-то это правильно, но! Но это ни в коем виде не снимает ответственности с вопросов конфигурации. Не правильно считать, что все проблемы за вас уже решены другими людьми и если что-то в вашей работе выходит за пределы гайдов, то можно &ldquo;немножко поговнокодить&rdquo;.</p><h1 id=монолит---не-монолит class="relative group">Монолит - не монолит <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%bc%d0%be%d0%bd%d0%be%d0%bb%d0%b8%d1%82---%d0%bd%d0%b5-%d0%bc%d0%be%d0%bd%d0%be%d0%bb%d0%b8%d1%82 aria-label=Якорь>#</a></span></h1><p>Хотя, я не с того начал. Сначала стоит спросить, кто из вас работает над проектом-монолитом?
Вот этим людям, скорее всего, статья в первой его части не интересной, ибо все намного проще (нет, не просто, проблемы есть), когда у вас приложение - монолит. Что мы имеем: все изменения хранятся в одном месте, их намного проще синхронизировать. Очень часто, с монолитами никаких <em>серьезных</em> проблем не возникает. А если и возникают какие-то конфликты в плане конфигурирования - они не причиняют много боли. Немного абстрактных костылей, немного террора в сторону DevOps и все, проблемы, в большинстве своем, решены. Но вот когда же оно начинает разделяться на маленькие сервисы (советую с этим не торопиться, если не знаете во что ввязываетесь) - тут возникает много вопросов касательно того, как поддерживать консистентность, и, в том числе, в конфигурации. Ведь все прекрасно понимают, что чем больше независимых компонентов в системе, тем сложнее их синхронизировать. А еще подключается правило &ldquo;работает - не трогай&rdquo;, о котором мы поговорим позже :).</p><p>Поэтому у меня сегодня несколько целей:</p><ol><li>Поворчать по поводу того, как люди стреляют себе в ногу и считают это нормальным.</li><li>Посеять нотку сомнения среди части людей по поводу того, что все хорошо и ничего не нужно делать / менять.</li><li>Осветить проблему микросервисов на руби (да и не только на руби, но у нас же Railsclub, поэтому руби)</li></ol><h1 id=существующие-подходы class="relative group">Существующие подходы <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d1%81%d1%83%d1%89%d0%b5%d1%81%d1%82%d0%b2%d1%83%d1%8e%d1%89%d0%b8%d0%b5-%d0%bf%d0%be%d0%b4%d1%85%d0%be%d0%b4%d1%8b aria-label=Якорь>#</a></span></h1><p>А для этого нужно посмотреть на ретроспективу, без этого никак. Все помнят, как эволюционировали подходы к конфигурации? Кстати, все заметили, что я не спросил еще ни у кого, что по их мнению является <em>конфигурацией</em>?</p><h2 id=constants class="relative group">Constants <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#constants aria-label=Якорь>#</a></span></h2><p>Самый простой, быстрый и, в некоторых случаях, незаменимый вариант. Достаточно вспомнить как описывается версия ruby gem&rsquo;а.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#75715e># lib/persey/version.rb</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> Persey
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>VERSION</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.11&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># persey.gemspec</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Gem</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Specification</span><span style=color:#f92672>.</span>new <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>spec<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>  spec<span style=color:#f92672>.</span>version <span style=color:#f92672>=</span> <span style=color:#66d9ef>Persey</span><span style=color:#f92672>::</span><span style=color:#66d9ef>VERSION</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Подход, с использованием констант для в роли инструмента для конфигурации я вижу очень часто, особенно в различных библиотеках.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#75715e># https://github.com/rails/rails/blob/master/actioncable/lib/action_cable/gem_version.rb</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> ActionCable
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>.</span><span style=color:#a6e22e>gem_version</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Gem</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Version</span><span style=color:#f92672>.</span>new <span style=color:#66d9ef>VERSION</span><span style=color:#f92672>::</span><span style=color:#66d9ef>STRING</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>module</span> VERSION
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>MAJOR</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>MINOR</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>TINY</span>  <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>PRE</span>   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;alpha&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>STRING</span> <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>MAJOR</span>, <span style=color:#66d9ef>MINOR</span>, <span style=color:#66d9ef>TINY</span>, <span style=color:#66d9ef>PRE</span><span style=color:#f92672>].</span>compact<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Или вот:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#75715e># https://github.com/rails/rails/blob/master/actioncable/lib/action_cable.rb</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> ActionCable
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>extend</span> <span style=color:#66d9ef>ActiveSupport</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Autoload</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>INTERNAL</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>message_types</span>: {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>welcome</span>: <span style=color:#e6db74>&#34;welcome&#34;</span><span style=color:#f92672>.</span>freeze,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>ping</span>: <span style=color:#e6db74>&#34;ping&#34;</span><span style=color:#f92672>.</span>freeze,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>confirmation</span>: <span style=color:#e6db74>&#34;confirm_subscription&#34;</span><span style=color:#f92672>.</span>freeze,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>rejection</span>: <span style=color:#e6db74>&#34;reject_subscription&#34;</span><span style=color:#f92672>.</span>freeze
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e6db74>default_mount_path</span>: <span style=color:#e6db74>&#34;/cable&#34;</span><span style=color:#f92672>.</span>freeze,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>protocols</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;actioncable-v1-json&#34;</span><span style=color:#f92672>.</span>freeze,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;actioncable-unsupported&#34;</span><span style=color:#f92672>.</span>freeze
</span></span><span style=display:flex><span>    <span style=color:#f92672>].</span>freeze
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://github.com/rails/rails/blob/master/actioncable/lib/action_cable/connection/web_socket.rb</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> ActionCable
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>module</span> Connection
</span></span><span style=display:flex><span>    <span style=color:#75715e># Wrap the real socket to minimize the externally-presented API</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WebSocket</span> <span style=color:#75715e># :nodoc:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>initialize</span>(env,
</span></span><span style=display:flex><span>                     event_target,
</span></span><span style=display:flex><span>                     event_loop,
</span></span><span style=display:flex><span>                     <span style=color:#e6db74>protocols</span>: <span style=color:#66d9ef>ActionCable</span><span style=color:#f92672>::</span><span style=color:#66d9ef>INTERNAL</span><span style=color:#f92672>[</span><span style=color:#e6db74>:protocols</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                    )
</span></span><span style=display:flex><span>         <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Проекты бо&rsquo;льшего масштаба исключением не являются (к сожалению). И если, в примерах выше, это хоть как-то это можно назвать константами, то в реальности разработчики настолько увлекаются, что записывают в константы все что угодно.</p><p>Как-то я был на собеседовании в одной компании. В ходе собеседования мы затронули тему &ldquo;А как ты думаешь, можно ли использовать константы для хранения конфигурации?&rdquo;. Я тогда однозначно ответил что нет, что это плохо. Спойлер (именно из-за этого мою кандидатуру и отвергли, за что им большое спасибо).</p><p>Какие доводы были приведены в пользу использования констант?</p><ol><li>К константам можно получить доступ отовсюду (если файл с константами загружен)</li><li>Константы позволяют повысить читаемость кода. Магические числа и строки пропадают.</li><li>Легко ищутся по коду (ты ищешь название константы, а не магическое число)</li><li>Нельзя модифицировать в runtime.</li></ol><p>Ну в принципе, все так и есть (почти). Но вот контраргументы тоже есть.</p><ol><li>Никто не держит константы в одном месте. Они всегда размазываются по коду. Для того, чтобы переиспользовать ту или иную константу, нужно знать, где она лежит (в каком файле/модуле/классе). А это никто не хочет запоминать (более того, это никому не нужно). В итоге, все приводит к тому, что разработчики начинают дублировать эти конфигурационные параметры. Как только нужно поменять ту или иную магическую строчку, начинается игра в &ldquo;угадай, как коллега назвал константу&rdquo;, для того, чтобы найти её по коду. Лечится ли эта проблема? Да, побольше дисциплины, концентрации и внимания. Только вот зачем все это?</li><li>Грань между константным значением и параметром конфигурации начинает теряться. В константы начинают пихать все, что придет в голову.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>RETRIES_COUNT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>API_HOST</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://your.domain.com&#39;</span>
</span></span></code></pre></div><ol start=3><li>Разные окружения превращают жизнь в ад. В тестовой среде нужны одни значения, на стейжинге другие, в продакшене третьи и тремя-четырьмя окружениями проект может не ограничиться.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>RETRIES_COUNT</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>Rails</span><span style=color:#f92672>.</span>env
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>when</span> <span style=color:#e6db74>&#39;test&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>when</span> <span style=color:#e6db74>&#39;development&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>when</span> <span style=color:#e6db74>&#39;staging&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                  <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>API_HOST</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>Rails</span><span style=color:#f92672>.</span>env
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>when</span> <span style=color:#e6db74>&#39;test&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#e6db74>&#39;https://fake.domain.com&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>when</span> <span style=color:#e6db74>&#39;development&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#e6db74>&#39;https://loalhost:3000&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>when</span> <span style=color:#e6db74>&#39;staging&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#e6db74>&#39;https://your-staging.domain.com&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                  <span style=color:#e6db74>&#39;https://your-production.domain.com&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>end</span>
</span></span></code></pre></div><ol start=4><li>Не изменяются? Ну да, конечно.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SomeClass</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_STRING</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_NUMBER</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_ARRAY</span> <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_HASH</span> <span style=color:#f92672>=</span> { <span style=color:#e6db74>a</span>: <span style=color:#e6db74>:b</span> }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_HELL</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>a</span>: <span style=color:#66d9ef>CONSTANT_HASH</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span>: <span style=color:#66d9ef>CONSTANT_ARRAY</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>c</span>: {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>d</span>: <span style=color:#e6db74>:e</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>f</span>: <span style=color:#f92672>[</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> pry(main)<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SomeClass</span><span style=color:#f92672>::</span><span style=color:#66d9ef>CONSTANT_STRING</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> pry(main)<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SomeClass</span><span style=color:#f92672>::</span><span style=color:#66d9ef>CONSTANT_STRING</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#39;smth&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;stringsmth&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> pry(main)<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SomeClass</span><span style=color:#f92672>::</span><span style=color:#66d9ef>CONSTANT_STRING</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;stringsmth&#34;</span>
</span></span></code></pre></div><p>Всем известно, что тут все просто, используем .freeze и тогда нельзя будет менять никакие значения.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SomeClass</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_STRING</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;string&#34;</span><span style=color:#f92672>.</span>freeze
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_NUMBER</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>.</span>freeze
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_ARRAY</span> <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span><span style=color:#f92672>].</span>freeze
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_HASH</span> <span style=color:#f92672>=</span> { <span style=color:#e6db74>a</span>: <span style=color:#e6db74>:b</span> }<span style=color:#f92672>.</span>freeze
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTANT_HELL</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>a</span>: <span style=color:#66d9ef>CONSTANT_HASH</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>b</span>: <span style=color:#66d9ef>CONSTANT_ARRAY</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>c</span>: {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>d</span>: <span style=color:#e6db74>:e</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>f</span>: <span style=color:#f92672>[</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }<span style=color:#f92672>.</span>freeze
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> pry(main)<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SomeClass</span><span style=color:#f92672>::</span><span style=color:#66d9ef>CONSTANT_STRING</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> pry(main)<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SomeClass</span><span style=color:#f92672>::</span><span style=color:#66d9ef>CONSTANT_STRING</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#39;smth&#39;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>RuntimeError</span>: can<span style=color:#e6db74>&#39;t modify frozen String
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[3] pry(main)&gt; SomeClass::CONSTANT_HELL[:a] = 123
</span></span></span><span style=display:flex><span><span style=color:#e6db74>RuntimeError: can&#39;</span>t modify frozen <span style=color:#66d9ef>Hash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> pry(main)<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SomeClass</span><span style=color:#f92672>::</span><span style=color:#66d9ef>CONSTANT_HELL</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=&gt;</span> {<span style=color:#e6db74>:a</span><span style=color:#f92672>=&gt;</span>{<span style=color:#e6db74>:a</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>:b</span>}, <span style=color:#e6db74>:b</span><span style=color:#f92672>=&gt;[</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span><span style=color:#f92672>]</span>, <span style=color:#e6db74>:c</span><span style=color:#f92672>=&gt;</span>{<span style=color:#e6db74>:d</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>:e</span>, <span style=color:#e6db74>:f</span><span style=color:#f92672>=&gt;[</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span><span style=color:#f92672>]</span>}}
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>5</span><span style=color:#f92672>]</span> pry(main)<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SomeClass</span><span style=color:#f92672>::</span><span style=color:#66d9ef>CONSTANT_HELL</span><span style=color:#f92672>[</span><span style=color:#e6db74>:c</span><span style=color:#f92672>][</span><span style=color:#e6db74>:d</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>123</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>123</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>6</span><span style=color:#f92672>]</span> pry(main)<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SomeClass</span><span style=color:#f92672>::</span><span style=color:#66d9ef>CONSTANT_HELL</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=&gt;</span> {<span style=color:#e6db74>:a</span><span style=color:#f92672>=&gt;</span>{<span style=color:#e6db74>:a</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>:b</span>}, <span style=color:#e6db74>:b</span><span style=color:#f92672>=&gt;[</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span><span style=color:#f92672>]</span>, <span style=color:#e6db74>:c</span><span style=color:#f92672>=&gt;</span>{<span style=color:#e6db74>:d</span><span style=color:#f92672>=&gt;</span><span style=color:#ae81ff>123</span>, <span style=color:#e6db74>:f</span><span style=color:#f92672>=&gt;[</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span><span style=color:#f92672>]</span>}}
</span></span></code></pre></div><p>Только вот freeze не &ldquo;замораживает&rdquo; вложенные объекты, и на такую ситуацию можно очень легко нарваться.</p><p>Но нужно отдать должное: переопределить константу не получится. Это единственное, пожалуй, чем они хороши.</p><p>Если кому-то интересно спросить про то, как это работает внутри ruby машины - поговорим с вами от этом в кулуарах, поэтому пойдем дальше.</p><p>Да, если кто-то хочет сказать, что можно при этом использовать переменные окружения - да, можно. Но это также не работает :)</p><h2 id=config-file class="relative group">Config file <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#config-file aria-label=Якорь>#</a></span></h2><p>Второй по популярности подход - складывать все параметры в YAML файлы, которые потом будут считаны и полученный хеш будет использоваться как объект хранения конфигурации.</p><p>Плюсы у этого подхода, несомненно есть. Как и минусы, в прочем&mldr;</p><h3 id=плюсы class="relative group">Плюсы: <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%bf%d0%bb%d1%8e%d1%81%d1%8b aria-label=Якорь>#</a></span></h3><ol><li>Наконец-то конфигурация стала аккумулироваться в одном месте</li><li>YAML файлы позволяют изящно описать конфигурацию, разделить по окружениям, убрать дублирование</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>common</span>: <span style=color:#75715e>&amp;common</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>adapter</span>: <span style=color:#ae81ff>postgresql</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>:     <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_HOST&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>database</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_NAME&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>username</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_USERNAME&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_PASSWORD&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>encoding</span>: <span style=color:#ae81ff>unicode</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pool</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_POOL&#39;) %&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>development</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;&lt;</span>: <span style=color:#75715e>*common</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;&lt;</span>: <span style=color:#75715e>*common</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>staging</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;&lt;</span>: <span style=color:#75715e>*common</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>5432</span>
</span></span></code></pre></div><ol start=3><li>Можно использовать переменные окружения (вариант прогона считанного файла через ERB препроцессор используется повсеместно)</li><li>Разделение конфигов по предметным областям - это очень хорошо. Люблю, когда все лежит по полочкам.</li></ol><h3 id=минусы class="relative group">Минусы: <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%bc%d0%b8%d0%bd%d1%83%d1%81%d1%8b aria-label=Якорь>#</a></span></h3><ol><li>Вы зависите от внутренней реализации того или иного гема (особенно в части использование переменных окружения). Например, конфиг базы данных проходит обработку ERB препроцессором. А что случилось с <code>cable.yml</code>? За что его обделили?</li><li>Вы не можете переприменять один и тот же параметр конфигурирования между разными файлами, так как они автономны. Исключение конечно можно сходу сказать - шарить эти данные через переменные окружения. Кто из вас это делал в большом проекте, где таких переменных окружения довольно много.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  $ grep -R ENV config app lib | wc -l
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>458</span>
</span></span></code></pre></div><ol start=3><li>Вы не можете переприменять части конфига в самом конфиге (ну на самом деле это не правда, имеется ввиду то, что изящно это сделать не получится)</li><li>Сложно поддерживать изменения, если их структура файлов изменяется</li><li>И самая большая проблема - сложно следить за изменениями в этих конфигурационных файлах.</li></ol><p>С последним пунктом я познакомился довольно давно, когда контрибьютил в Gitlab. Там было 3 основных проблемы:</p><ol><li>Синхронизация изменений файлов (исходные файлы поставлялись в виде <code>config.yml.example</code>), который нужно было скопировать и переписать. Как только в <code>config.yml.example</code> появляются новые параметры, которые вы, в силу какие-то обстоятельств, не заметили, у вас могут начаться проблемы.</li><li>Поддержка изменений в самих файлах (поддержка обратной совместимости)</li><li>Дублирование конфигурационных параметров (был gitlab-shell и сам gitlab. Обе части должны были знать о том, по какому пути лежат репозитории. Если приходилось менять один параметр - нужно было помнить про другой. Но Погодите, это же один продукт, что за фигня?)</li></ol><p>Как решились эти проблемы? Да никак. Ну то есть мы у себя решили их ;) но <code>Undev</code> больше нет и никто уже про это не вспоминает. Я, по крайней мере, надеюсь на это.</p><p>Что ж, на текущий момент этот подход лидирует в сообществе rails (и не только) разработчиков.</p><h2 id=dsl class="relative group">DSL <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#dsl aria-label=Якорь>#</a></span></h2><p>Про этот вариант наверное стоило сказать раньше, так как он появился и прижился раньше, чем вариант с файлами конфигурации. Но я его все же поставил следующим пунктом, так как он все же может использоваться в более гибком варианте.</p><p>Я думаю, что все знают про</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>Rails</span><span style=color:#f92672>.</span>application<span style=color:#f92672>.</span>configure <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Так вот этот вариант как раз из этой оперы.</p><p>Плюсы:</p><ol><li>Конфиг читается очень хорошо</li><li>Конфиг == код. Возможностей для описания конфигурации становится больше</li><li>Можно тестировать (!!!). Да, конфиг можно протестировать и быть уверенным что с ним все хорошо. Только вот никто это не делает. Тут, конечно, можно похоливарить, о том что нужно тестировать, а что нет.</li><li>Все плюсы из <strong>Config object</strong></li></ol><p>Мне в частности, еще нравится вариант <code>Dry-configurable</code> (я вообще поклонник Dry)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>extend</span> <span style=color:#66d9ef>Dry</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Configurable</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Pass a block for nested configuration (works to any depth)</span>
</span></span><span style=display:flex><span>  setting <span style=color:#e6db74>:database</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Can pass a default value</span>
</span></span><span style=display:flex><span>    setting <span style=color:#e6db74>:dsn</span>, <span style=color:#e6db74>&#39;sqlite:memory&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Defaults to nil if no default value is given</span>
</span></span><span style=display:flex><span>  setting <span style=color:#e6db74>:adapter</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Pre-process values</span>
</span></span><span style=display:flex><span>  setting(<span style=color:#e6db74>:path</span>, <span style=color:#e6db74>&#39;test&#39;</span>) { <span style=color:#f92672>|</span>value<span style=color:#f92672>|</span> <span style=color:#66d9ef>Pathname</span>(value) }
</span></span><span style=display:flex><span>  <span style=color:#75715e># Passing the reader option as true will create attr_reader method for the class</span>
</span></span><span style=display:flex><span>  setting <span style=color:#e6db74>:pool</span>, <span style=color:#ae81ff>5</span>, <span style=color:#e6db74>reader</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Passing the reader attributes works with nested configuration</span>
</span></span><span style=display:flex><span>  setting <span style=color:#e6db74>:uploader</span>, <span style=color:#e6db74>reader</span>: <span style=color:#66d9ef>true</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    setting <span style=color:#e6db74>:bucket</span>, <span style=color:#e6db74>&#39;dev&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>App</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>database<span style=color:#f92672>.</span>dsn
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; &#34;sqlite:memory&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>App</span><span style=color:#f92672>.</span>configure <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>config<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>  config<span style=color:#f92672>.</span>database<span style=color:#f92672>.</span>dsn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;jdbc:sqlite:memory&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>App</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>database<span style=color:#f92672>.</span>dsn
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; &#34;jdbc:sqlite:memory&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>App</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>adapter
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; nil</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>App</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>path
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; #&lt;Pathname:test&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>App</span><span style=color:#f92672>.</span>pool
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; 5</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>App</span><span style=color:#f92672>.</span>uploader<span style=color:#f92672>.</span>bucket
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; &#39;dev&#39;</span>
</span></span></code></pre></div><h2 id=singleton class="relative group">Singleton <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#singleton aria-label=Якорь>#</a></span></h2><p>Также довольно крепко прижился подобный вариант хранения конфигурации и в рубишном мире (в том числе и в самом коде Rails).</p><p>Суть в этом подходе сводится к следующему: данные конфигурации считываются из какого-то источника (источников) и сохраняются в одном объекте.</p><p>Плюсы и минусы зависят от того, откуда и как берутся эти данные.</p><h2 id=db class="relative group">DB <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#db aria-label=Якорь>#</a></span></h2><p>Я всегда вспоминаю времена работы в web студии, когда клепал стайтики на CMS&rsquo;ках, когда вижу подобный подход. Когда есть табличка в базе, там в виде key => value хранятся параметры конфигурирование и разработчик из кода бегает в эту базу для того, чтобы считывать те или иные значения. На самом деле, отвратительно плохого в этом ничего нет. Это один из способов расшарить конфигурацию, которая может поменяться в любой момент. И не важно, где она будет (PostgreSQL, Redis, etc)</p><p>Проблемы:</p><ul><li>Очень хрупкая система (живет только в том случае, когда невозможно удалить ключ)</li><li>Нагрузка на базу данных может быть очень большой</li><li>Паразитный траффик</li><li>Просадки в скорости работы приложения</li></ul><p>Плюсы:</p><ul><li>Конфигурацию отдельных компонентов системы можно менять на лету</li><li>Шаринг конфигурации между разными сервисами из коробки</li></ul><h1 id=проблемы-на-которые-большинство-не-обращает-внимания class="relative group">Проблемы, на которые большинство не обращает внимания <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%bf%d1%80%d0%be%d0%b1%d0%bb%d0%b5%d0%bc%d1%8b-%d0%bd%d0%b0-%d0%ba%d0%be%d1%82%d0%be%d1%80%d1%8b%d0%b5-%d0%b1%d0%be%d0%bb%d1%8c%d1%88%d0%b8%d0%bd%d1%81%d1%82%d0%b2%d0%be-%d0%bd%d0%b5-%d0%be%d0%b1%d1%80%d0%b0%d1%89%d0%b0%d0%b5%d1%82-%d0%b2%d0%bd%d0%b8%d0%bc%d0%b0%d0%bd%d0%b8%d1%8f aria-label=Якорь>#</a></span></h1><h2 id=много-конфигов class="relative group">Много конфигов <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%bc%d0%bd%d0%be%d0%b3%d0%be-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d0%be%d0%b2 aria-label=Якорь>#</a></span></h2><p>Очевидно, что чем сложнее приложение, тем больше библиотек используется. И зачастую, каждая библиотека просит свой собственный конфигурационный файл. Если говорить в контексте Rails, это приводит к тому, что 2 директории начинают распухать от количества подобных файлов:</p><p><code>config</code>
<code>config/initializers</code></p><p>Проблема тут, как понимаете, не в количестве файлов, а в количестве переменных/модулей/классов, которые хранят значения конфигурации.
Так или иначе, рост количества таких сущностей приводит к тому, что появляются дополнительные абстракции, для того, чтобы соблюсти принципы DRY, что приводит к большой связанности кода и меньшему пониманию, что происходит. И начинается проявляться дополнительная проблема, как обеспечить консистентность конфигурации. Проблема поддержки. Однако, эта проблема легко перекладывается на плечи других людей (например DevOps, мы же говорили о том, что можно все эти проблемы решить при помощи переменных окружения, хотя и это тоже бред, как минимум потому что в конце концов невозможно придумывать и совмещать большое количество переменных)</p><h2 id=разные-форматы-файлов class="relative group">Разные форматы файлов <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d1%80%d0%b0%d0%b7%d0%bd%d1%8b%d0%b5-%d1%84%d0%be%d1%80%d0%bc%d0%b0%d1%82%d1%8b-%d1%84%d0%b0%d0%b9%d0%bb%d0%be%d0%b2 aria-label=Якорь>#</a></span></h2><p>С подобной ситуацией сталкивается не так много команд и проектов, однако такое бывает и стоит про это сказать. Как много людей используют в своих решениях не только ruby библиотеки а конкретный софт, который имеет вполне конкретную конфигурацию?
Что, если есть небольшие сервисы, которые имеют свои конфиги? Вам же при этом (не всегда) нужно учитывать параметры из этих конфигов. Копипастить? Прокидывать через переменные окружения? А что делать, если сервис запускается супервизиром при старте системы? Жонглировать параметрами окружения? А если сервис не может считать эти параметры окружения (умеет читать только из файла)? Переписывать сервис только для того, чтобы он смог это сделать? А если вы не знаете язык программирования или ПО проприетарное?
Все эти вопросы в итоге сводятся к тому, что нужно просто продублировать важные параметры. Просто продублировать, вместо того, чтобы переиспользовать. Да, я не спорю, этот вопрос также можно решить при помощи DevOps&rsquo;ов. Да и то, не всегда. В общем, иногда возникает ситуация, когда нужно просто считать еще один конфиг и иметь к нему доступ из кода приложения.</p><h2 id=динамическое-конфигурирование--использование-конфигурации-в-конфигурации class="relative group">Динамическое конфигурирование & использование конфигурации в конфигурации <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%b4%d0%b8%d0%bd%d0%b0%d0%bc%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%be%d0%b5-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5--%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8-%d0%b2-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8 aria-label=Якорь>#</a></span></h2><p>Как часто вам нужно из нескольких параметров конфигурации собрать 1?
Далеко ходить не нужно - строка подключения к базе данных.
Вспомним про конфиг базы данных.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>common</span>: <span style=color:#75715e>&amp;common</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>adapter</span>: <span style=color:#ae81ff>postgresql</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>:     <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_HOST&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>database</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_NAME&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>username</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_USERNAME&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_PASSWORD&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>encoding</span>: <span style=color:#ae81ff>unicode</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pool</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_POOL&#39;) %&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>development</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;&lt;</span>: <span style=color:#75715e>*common</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;&lt;</span>: <span style=color:#75715e>*common</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>staging</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;&lt;</span>: <span style=color:#75715e>*common</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>5432</span>
</span></span></code></pre></div><p>И вам в приложении нужно использовать не только данные в поэтом формате, но и строку подключения одной строкой. Что в таком случае делать?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>common</span>: <span style=color:#75715e>&amp;common</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>adapter</span>: <span style=color:#ae81ff>postgresql</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>:     <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_HOST&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>database</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_NAME&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>username</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_NAME&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_PASSWORD&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>encoding</span>: <span style=color:#ae81ff>unicode</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pool</span>: <span style=color:#ae81ff>&lt;%= ENV.fetch(&#39;DB_POOL&#39;) %&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>dsn</span>: <span style=color:#ae81ff>postgres://&lt;%= ENV.fetch(&#39;DB_NAME&#39;) %&gt;:&lt;%= ENV.fetch(&#39;DB_PASSWORD&#39;) %&gt;@&lt;%= ENV.fetch(&#39;DB_HOST&#39;) %&gt;:&lt;%= ENV.fetch(&#39;DB_PORT&#39;) %&gt;/&lt;%= ENV.fetch(&#39;DB_NAME&#39;) %&gt;?pool=&lt;%= ENV.fetch(&#39;DB_POOL&#39;) %&gt;</span>
</span></span></code></pre></div><p>Никто не видит в этом проблему? На самом деле проблемы нет, есть досадная неприятность в виде необходимости контролировать 2 места использования переменной окружения вместо одного.</p><p>Но вот если наоборот, из 1 параметра вычленить несколько аттрибутов? У вас на входе <code>dsn</code> а нужно разбить на отдельные параметры (например строка подключения к AWS RDS DB)?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#e6db74>common</span>: <span style=color:#f92672>&amp;</span>common
</span></span><span style=display:flex><span>  <span style=color:#e6db74>dsn</span>:      <span style=color:#f92672>&lt;%=</span> <span style=color:#66d9ef>ENV</span><span style=color:#f92672>.</span>fetch(<span style=color:#960050;background-color:#1e0010>‘</span><span style=color:#66d9ef>DB_DSN</span><span style=color:#960050;background-color:#1e0010>’</span>) <span style=color:#f92672>%&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>adapter</span>:  <span style=color:#e6db74>??</span>?
</span></span><span style=display:flex><span>  <span style=color:#e6db74>host</span>:     <span style=color:#e6db74>??</span>?
</span></span><span style=display:flex><span>  <span style=color:#e6db74>database</span>: <span style=color:#e6db74>??</span>?
</span></span><span style=display:flex><span>  <span style=color:#e6db74>username</span>: <span style=color:#e6db74>??</span>?
</span></span><span style=display:flex><span>  <span style=color:#e6db74>password</span>: <span style=color:#e6db74>??</span>?
</span></span><span style=display:flex><span>  <span style=color:#e6db74>encoding</span>: unicode
</span></span><span style=display:flex><span>  <span style=color:#e6db74>pool</span>: <span style=color:#e6db74>??</span>?
</span></span></code></pre></div><p>Или дополнить 1 параметр дополнительным данными (например несколько баз данных у редиса)? Вот тут геморроя побольше прибавляется.</p><p>Смысла забивать область переменных окружений по каждому чиху я особо не вижу. Достаточно затребовать поддержки подобного поведения/фич у той части проекта, которая отвечает за конфигурацию.</p><h2 id=комбинирование-разных-типов-конфигурации class="relative group">Комбинирование разных типов конфигурации <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%ba%d0%be%d0%bc%d0%b1%d0%b8%d0%bd%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d1%80%d0%b0%d0%b7%d0%bd%d1%8b%d1%85-%d1%82%d0%b8%d0%bf%d0%be%d0%b2-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8 aria-label=Якорь>#</a></span></h2><p>А что делать, когда у вас есть конфигурация, описанная при помощи DSL, конфигурация, которая лежит в базе данных, файлики с конфигами, конфиги, переданные через переменные окружения? Перевести все на один формат? Например использовать только YAML файлы или только DSL? Вообще-то это правильная мысль и я бы выбрал второй вариант. Как минимум в этом случае вы можете использовать <code>lambda</code> для того, чтобы включить один конфиг во второй.</p><h2 id=переиспользование-конфигурации-в-родительских-проектах-config-registry class="relative group">Переиспользование конфигурации в родительских проектах (config registry) <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%bf%d0%b5%d1%80%d0%b5%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8-%d0%b2-%d1%80%d0%be%d0%b4%d0%b8%d1%82%d0%b5%d0%bb%d1%8c%d1%81%d0%ba%d0%b8%d1%85-%d0%bf%d1%80%d0%be%d0%b5%d0%ba%d1%82%d0%b0%d1%85-config-registry aria-label=Якорь>#</a></span></h2><p>Это также интересный момент. Давайте представим ситуацию: вы пишете небольшое приложение, которые берет данные из API, что-то с ними делает, результат записывает файл и загружает его в AWS S3 бакет. В этой абстрактной задачке можно выделить 3 компонента:</p><ol><li>Обращение к API</li><li>Выполнение операции</li><li>Загрузка файла</li></ol><p>Очевидно, что каждая из этих частей (как минимум 2) будут требовать credentials. И скорее всего, они будут лежать в 2 файликах рядышком и первая и третья компонента прекрасно их считает и все будет работать. Теперь вопрос: какова вероятность того, что вам потребуется во второй компоненте учитывать конфигурационнные параметры из 1 и 3?</p><p>Тут возникают следующие вопросы:</p><ol><li>Вы используете стороннее решение?</li><li>Обращаться к объекту конфигурации?</li><li>Если конфигурация инкапсулирована и публичного доступа к ней нет?</li></ol><p>Конечно, это же руби, вы можете вызывать приватные методы и дотянуться до самих пикантных мест, рискуя наткнуться на то, что ваш код сломается, когда изменится внутренний интерфейс библиотеки.</p><p>Или проще объединить эти 2 конфига (сделать proxy интерфейс к ним).</p><p>А теперь представим, что у нас есть некое описание моделей, с которыми может работать ваши сервисы, и вы вычленили их в отдельный гем. Так или иначе, этот гем будет иметь конфигурацию, и вам может понадобиться доступ к параметрам каких-то ключей из вашего сервиса. Как поступать в таком случае? Дублировать конфиги? Или переиспользовать объект конфигурации из родительского класса?</p><p>А если вы при этом подключили еще 1 библиотеку, и там есть свой конфиг? Обращаться напрямую к этому конфигу или тоже, пробросить доступ к нему через ваш конфиг? Если выбираете первый вариант, вам не кажется что это похоже на историю с размазывание констант? И Как быть с правилом одного уровня абстракции? И как гарантировать, что ваш интерфейс конфигурации будет неизменным (подмена бекенда не призывает к изменению кода)?</p><h2 id=перезагрузка-конфигов class="relative group">Перезагрузка конфигов <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%bf%d0%b5%d1%80%d0%b5%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b0-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d0%be%d0%b2 aria-label=Якорь>#</a></span></h2><h3 id=перезапуск-приложения-vs-перезагрузка-конфигурации class="relative group">Перезапуск приложения vs перезагрузка конфигурации <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%bf%d0%b5%d1%80%d0%b5%d0%b7%d0%b0%d0%bf%d1%83%d1%81%d0%ba-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d1%8f-vs-%d0%bf%d0%b5%d1%80%d0%b5%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b0-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8 aria-label=Якорь>#</a></span></h3><p>Вернемся ненадолго к монолитам. Когда у вас приложение выполнено в виде монолита у него есть как плюсы, так и минусы в плане возможности использовать такой подход к обновлению конфигурации. Стоит начать с того, что практического смысла в перезагрузке конфигурации без перезапуска приложения особо то и нет. Как минимум потому, что в самом проекте изменения (обычно) происходят довольно быстро и вероятность того, что изменение конфигурации может придти с изменением кода очень велика. Да и изменение конфигурации в этом случае приравнивается к изменению кода, ввиду того, что связность кода очень велика.</p><p>Ситуация немного меняется, когда монолит запускается не совсем как монолит. Несмотря на то, что код и лежит в одном месте, но запускаются все эти компоненты отдельно. Например, отдельно API (да и сам API может также разделяться, например по версиям), Отдельно web часть лично кабинета, отдельно публичные контроллеры, отдельно фоновые задачи <code>critical</code> уровня и так далее.</p><p>И все кардинально изменяется, когда вместо 1-го большого приложения у вас становится много маленьких (или как люди любят это называть - микросервисы).</p><p>В последних 2-х случаях законным становится вопрос:
<strong>Имеет ли практический смысл перезапуск всех сервисов, если код в них не поменялся, но произошли изменения в конфигурации?</strong></p><p>Конечно, этот вопрос имеет еще много других параметров:</p><ul><li>Какова стоимость перезапуска сервиса?</li><li>Нужно ли перезапускать сервис?</li></ul><p>Очевидно, что чем меньше сервис, тем легковеснее его перезапуск. И даунтайм здесь может быть довольно мал. Но что из себя представляет этот перезапуск? <strong>Graceful restart</strong> или <strong>SIGKIL</strong> + <strong>SIGEXIT</strong>? Если у вас второй вариант - перезапуск всех сервисов при необходимости перезагрузить конфигурацию становится опасной затеей. Как минимум потому что какой-то сервис может</p><ol><li>Выполнять тяжелые операции</li><li>Содержать кеш, который после перезапуска нужно прогревать</li><li>Преждевременная остановка работы может повлиять на консистентность данных</li><li>Очень частые перезапуски могут блокировать flow</li></ol><p>Уже этих пунктов достаточно для того, чтобы усомниться в полезности перезапускать все сервисы при изменении в одном.</p><p>Желание держать все сервисы запущенными &ldquo;на максимально свежем коде&rdquo; присущи многим разработчикам. Иногда до состояния фанатизма. Хм. А все из вас обновляют гемы каждый день (для того, чтобы гарантировать, что используется самая свежая версия гема)? А почему тогда нужно перезапускать сервис, если изменений в нем никаких не произошло (или изменения в соседнем сервисе не затрагивают изменения в каком-то конкретном)?</p><p>Таким образом для меня приоритетнее вопрос: <strong>А нужно ли его перезапускать?</strong> и <strong>Затрагивают ли изменения конфигурации/кода работу самого приложения?</strong></p><p>Давайте поподробнее разберем второй момент:</p><p>Хорошим тоном является наличие изолированных хранилищ у каждого микросервиса. Под хранилищем можно понимать, например, базу данных. И все данные прокидываются между этими сервисами по сети. Но на практике это практически не достижимо (как минимум сразу). Так или иначе, в самом начале у вас будет, например, пошарена база данных между этими сервисами. Не обязательно, между всеми. Или вам нужно использовать отдельное хранилище для коммуникаций (результат работы одного сервиса использовать в другом, при этом объем данных может быть весьма большим (У нас было такое, что несколько миллионов строк из одного сервиса нужно передать в другой). В таком случае получается, что изменение, например, части конфигурации (информации о местонахождении подобного хранилища) затрагивает не все сервисы системы, а только ограниченное число этих сервисов, соответственно, эти изменения не должны влиять на другие.</p><p>В таком случае, нужна возможность сообщить приложению о том, что конфигурация устарела и нужно ее обновить. Как это правильно сделать?</p><h3 id=api-интерфейс-для-обновлении-конфигурации class="relative group">API интерфейс для обновлении конфигурации <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#api-%d0%b8%d0%bd%d1%82%d0%b5%d1%80%d1%84%d0%b5%d0%b9%d1%81-%d0%b4%d0%bb%d1%8f-%d0%be%d0%b1%d0%bd%d0%be%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b8-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8 aria-label=Якорь>#</a></span></h3><p>Почему-то чаще всего предлагают реализовать API на стороне каждого сервиса, в которое можно постучать и сообщить о том, что произошло какое-то изменение. Ну&mldr; Так себе решение. Как-то лениво <strong>реализовывать</strong> подобный интерфейс для каждого сервиса самостоятельно.</p><h3 id=sighup-для-поддержки-перезагрузки-конфигурации class="relative group">SIGHUP для поддержки перезагрузки конфигурации <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#sighup-%d0%b4%d0%bb%d1%8f-%d0%bf%d0%be%d0%b4%d0%b4%d0%b5%d1%80%d0%b6%d0%ba%d0%b8-%d0%bf%d0%b5%d1%80%d0%b5%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b8-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8 aria-label=Якорь>#</a></span></h3><p>Идея сводится к тому, чтобы послать <strong>SIGHUP</strong> сигнал сервису, для того, чтобы он обновил конфигурацию (перечитал). Подобный подход пока что еще имеет широкого применения в мире Ruby. Но это логично, так как все привыкли перезапускать приложение, если что-то поменялось.</p><h3 id=проблема-конфликта-конфигурации-изменение-конфигурации-в-рантайме class="relative group">Проблема конфликта конфигурации (изменение конфигурации в рантайме) <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%bf%d1%80%d0%be%d0%b1%d0%bb%d0%b5%d0%bc%d0%b0-%d0%ba%d0%be%d0%bd%d1%84%d0%bb%d0%b8%d0%ba%d1%82%d0%b0-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8-%d0%b8%d0%b7%d0%bc%d0%b5%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8-%d0%b2-%d1%80%d0%b0%d0%bd%d1%82%d0%b0%d0%b9%d0%bc%d0%b5 aria-label=Якорь>#</a></span></h3><p>Давайте представим такую ситуацию: Мы умеем перезагружать конфигурацию в реальном времени. В таком случае можем получить ситуацию, когда код был запущен на одной конфигурации, произошло её обновление и он начал работать на основании другой конфигурации. С одной стороны, это может быть не страшным, с другой&mldr;может быть и полезным.
Например вы писали часть данных в одно место, тут прилетела информация о том, что нужно писать в другое место и вы решили переключиться. Выглядит это как-то не очень хорошо. Часть данных в одном месте, часть данных в другом и не известно где и сколько.
Или у вас было ограничение на длину строки. Было <code>1000</code> символов, стало <code>800</code>. Часть сгенерированных строк будут соответствовать требуемому результату, часть нет. Хорошо это или плохо? Я не могу сказать однозначно. Для нас подобные ситуации были и полезными и вредными. Но лучше, когда результат соответствует конкретному критерию. Либо все <code>1000</code> символов, либо все <code>800</code>.</p><p>Соответственно, лучше как-то это держать под контролем. Как много людей использует <code>config object</code> паттерн в своей работе?</p><h2 id=использование-config-object-подхода class="relative group">Использование config object подхода <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-config-object-%d0%bf%d0%be%d0%b4%d1%85%d0%be%d0%b4%d0%b0 aria-label=Якорь>#</a></span></h2><p>Прокидываем в класс/метод объект конфигурации и используем этот снепшот. За время выполнения операции конфиг может поменяться, снепшот остается неизменным. Если изменения конфигурации были критичными - выполнение завалится и сервис восстановится с новой конфигурацией, продолжит работу и все будет хорошо.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_ad_headline</span>(<span style=color:#e6db74>headline_parts</span>: <span style=color:#f92672>[]</span>)
</span></span><span style=display:flex><span>  headline <span style=color:#f92672>=</span> headline_parts<span style=color:#f92672>.</span>each_pair<span style=color:#f92672>.</span>each_with_object({}) <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>(ad_id, parts), acc<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    acc<span style=color:#f92672>[</span>ad_id<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> parts<span style=color:#f92672>.</span>each_with_object(<span style=color:#e6db74>&#34;&#34;</span>) <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>part, result_headline<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (result_headline <span style=color:#f92672>+</span> part)<span style=color:#f92672>.</span>size <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>YourApp</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>ads<span style=color:#f92672>.</span>headline<span style=color:#f92672>.</span>max_size
</span></span><span style=display:flex><span>        result_headline <span style=color:#f92672>&lt;&lt;</span> part
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_ad_headline</span>(<span style=color:#e6db74>headline_parts</span>: <span style=color:#f92672>[]</span>, <span style=color:#e6db74>config_object</span>: <span style=color:#66d9ef>YourApp</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>ads<span style=color:#f92672>.</span>headline)
</span></span><span style=display:flex><span>  headline <span style=color:#f92672>=</span> headline_parts<span style=color:#f92672>.</span>each_pair<span style=color:#f92672>.</span>each_with_object({}) <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>(ad_id, parts), acc<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    acc<span style=color:#f92672>[</span>ad_id<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> parts<span style=color:#f92672>.</span>each_with_object(<span style=color:#e6db74>&#34;&#34;</span>) <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>part, result_headline<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (result_headline <span style=color:#f92672>+</span> part)<span style=color:#f92672>.</span>size <span style=color:#f92672>&lt;</span> config<span style=color:#f92672>.</span>max_size
</span></span><span style=display:flex><span>        result_headline <span style=color:#f92672>&lt;&lt;</span> part
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><h2 id=pubsub-модель-обновления-конфигурации-проекта class="relative group">pub/sub модель обновления конфигурации проекта <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#pubsub-%d0%bc%d0%be%d0%b4%d0%b5%d0%bb%d1%8c-%d0%be%d0%b1%d0%bd%d0%be%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d1%8f-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8-%d0%bf%d1%80%d0%be%d0%b5%d0%ba%d1%82%d0%b0 aria-label=Якорь>#</a></span></h2><p>Consul config
etcd
подобные сервисы
Проблема: у вас есть несколько сервисов</p><h1 id=конфигурация-проекта-не-только-магические-строки class="relative group">Конфигурация проекта не только магические строки <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d1%8f-%d0%bf%d1%80%d0%be%d0%b5%d0%ba%d1%82%d0%b0-%d0%bd%d0%b5-%d1%82%d0%be%d0%bb%d1%8c%d0%ba%d0%be-%d0%bc%d0%b0%d0%b3%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%b8%d0%b5-%d1%81%d1%82%d1%80%d0%be%d0%ba%d0%b8 aria-label=Якорь>#</a></span></h1><p>Гибкий код с минимальным набором изменений.</p><h2 id=сервис-локатеры-как-часть-конфигурации-di class="relative group">Сервис-локатеры как часть конфигурации (DI) <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d1%81%d0%b5%d1%80%d0%b2%d0%b8%d1%81-%d0%bb%d0%be%d0%ba%d0%b0%d1%82%d0%b5%d1%80%d1%8b-%d0%ba%d0%b0%d0%ba-%d1%87%d0%b0%d1%81%d1%82%d1%8c-%d0%ba%d0%be%d0%bd%d1%84%d0%b8%d0%b3%d1%83%d1%80%d0%b0%d1%86%d0%b8%d0%b8-di aria-label=Якорь>#</a></span></h2><p>Не завязывайтесь на конкретный сервис (интерфейс гема) или класс, общающийся с внешним миром, напрямую. Используйте сервис-локатеры.</p><p><strong>Пример реализации с использование Dry-container</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ServiceLocator</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Container</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Dry</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Container</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Mixin</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>class</span> <span style=color:#f92672>&lt;&lt;</span> self
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>attr_reader</span> <span style=color:#e6db74>:instance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>configure</span>
</span></span><span style=display:flex><span>      container <span style=color:#f92672>=</span> <span style=color:#66d9ef>Container</span><span style=color:#f92672>.</span>new
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>yield</span>(container)
</span></span><span style=display:flex><span>      @instance <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span>(<span style=color:#66d9ef>Rails</span><span style=color:#f92672>.</span>application, container)
</span></span><span style=display:flex><span>      freeze
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>[]</span>(name)
</span></span><span style=display:flex><span>      instance<span style=color:#f92672>[</span>name<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>attr_reader</span> <span style=color:#e6db74>:app</span>, <span style=color:#e6db74>:container</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>initialize</span>(app, container)
</span></span><span style=display:flex><span>    @app <span style=color:#f92672>=</span> app
</span></span><span style=display:flex><span>    @container <span style=color:#f92672>=</span> container
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>[]</span>(name)
</span></span><span style=display:flex><span>    container<span style=color:#f92672>[</span>name<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ServiceLocator</span><span style=color:#f92672>.</span>configure <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>container<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>  load_environment <span style=color:#f92672>=</span> <span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>ENV</span><span style=color:#f92672>[</span><span style=color:#e6db74>&#39;PRODUCTION_SERVICE_LOCATOR&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                         <span style=color:#e6db74>:prod</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>elsif</span> <span style=color:#66d9ef>Rails</span><span style=color:#f92672>.</span>env<span style=color:#f92672>.</span>test? <span style=color:#f92672>||</span> <span style=color:#66d9ef>Rails</span><span style=color:#f92672>.</span>env<span style=color:#f92672>.</span>development?
</span></span><span style=display:flex><span>                         <span style=color:#e6db74>:fake</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                         <span style=color:#e6db74>:prod</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>                     <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> load_environment
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>when</span> <span style=color:#e6db74>:fake</span>
</span></span><span style=display:flex><span>    container<span style=color:#f92672>.</span>register(<span style=color:#e6db74>:sms_gateway</span>, lambda <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>Test</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Nexmo</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Client</span><span style=color:#f92672>.</span>new(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>key</span>: <span style=color:#66d9ef>PactApi</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>nexmo<span style=color:#f92672>.</span>api_key,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>secret</span>: <span style=color:#66d9ef>PactApi</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>nexmo<span style=color:#f92672>.</span>api_secret
</span></span><span style=display:flex><span>      )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    container<span style=color:#f92672>.</span>register(<span style=color:#e6db74>:mailgun_client</span>, lambda <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>Test</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Mailgun</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Client</span><span style=color:#f92672>.</span>new(<span style=color:#66d9ef>PactApi</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>mailgun<span style=color:#f92672>.</span>api_key)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    container<span style=color:#f92672>.</span>register(<span style=color:#e6db74>:sms_gateway</span>, lambda <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>Nexmo</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Client</span><span style=color:#f92672>.</span>new(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>key</span>: <span style=color:#66d9ef>PactApi</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>nexmo<span style=color:#f92672>.</span>api_key,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>secret</span>: <span style=color:#66d9ef>PactApi</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>nexmo<span style=color:#f92672>.</span>api_secret
</span></span><span style=display:flex><span>      )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    container<span style=color:#f92672>.</span>register(<span style=color:#e6db74>:mailgun_client</span>, lambda <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>Mailgun</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Client</span><span style=color:#f92672>.</span>new(<span style=color:#66d9ef>PactApi</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>mailgun<span style=color:#f92672>.</span>api_key)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>email_message<span style=color:#f92672>.</span>take_to_send!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mg_client <span style=color:#f92672>=</span> <span style=color:#66d9ef>ServiceLocator</span><span style=color:#f92672>[</span><span style=color:#e6db74>:mailgun_client</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>  response <span style=color:#f92672>=</span> mg_client<span style=color:#f92672>.</span>send_message <span style=color:#66d9ef>PactApi</span><span style=color:#f92672>.</span>config<span style=color:#f92672>.</span>mailgun<span style=color:#f92672>.</span>domain, payload
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> response<span style=color:#f92672>.</span>code <span style=color:#f92672>==</span> <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>    mailgun_message_id <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>to_h<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;id&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    mailgun_message_id<span style=color:#f92672>.</span>gsub!(<span style=color:#e6db74>/[&lt;&gt;]/</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>    email_message<span style=color:#f92672>.</span>update(<span style=color:#e6db74>external_id</span>: mailgun_message_id)
</span></span><span style=display:flex><span>    email_message<span style=color:#f92672>.</span>sent!
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    email_message<span style=color:#f92672>.</span>fail_send!
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>rescue</span>
</span></span><span style=display:flex><span>  email_message<span style=color:#f92672>.</span>fail_send!
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><h2 id=rail-way-написания-кода class="relative group">Rail-way написания кода <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rail-way-%d0%bd%d0%b0%d0%bf%d0%b8%d1%81%d0%b0%d0%bd%d0%b8%d1%8f-%d0%ba%d0%be%d0%b4%d0%b0 aria-label=Якорь>#</a></span></h2><p>При реализации старайтесь явно реализовать true-way процесса.</p><h1 id=вывод class="relative group">Вывод <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%d0%b2%d1%8b%d0%b2%d0%be%d0%b4 aria-label=Якорь>#</a></span></h1></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=400 height=400 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt="Андрей Куманяев" loading=lazy decoding=async src=https://zzet.org/img/author.jpeg></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Автор</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Андрей Куманяев</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://twitter.com/username target=_blank aria-label=Twitter rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/zzet target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://x.com/zzetorg target=_blank aria-label=X rel="me noopener noreferrer"></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://www.reddit.com/user/zzet/ target=_blank aria-label=Reddit rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://www.linkedin.com/in/andrey-kumanyaev/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></div></div></div></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/&amp;quote=Project%20configuration.%20Part%201.%20Railsclub%20intro." title="Поделиться на Facebook" aria-label="Поделиться на Facebook" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://x.com/intent/tweet/?url=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/&amp;text=Project%20configuration.%20Part%201.%20Railsclub%20intro." title="Post on X" aria-label="Post on X" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://tootpick.org/#text=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/%20Project%20configuration.%20Part%201.%20Railsclub%20intro." title="Поделиться на Mastodon" aria-label="Поделиться на Mastodon" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
</span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/&amp;resubmit=true&amp;title=Project%20configuration.%20Part%201.%20Railsclub%20intro." title="Опубликовать на Reddit" aria-label="Опубликовать на Reddit" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/&amp;title=Project%20configuration.%20Part%201.%20Railsclub%20intro." title="Поделиться на LinkedIn" aria-label="Поделиться на LinkedIn" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/&amp;subject=Project%20configuration.%20Part%201.%20Railsclub%20intro." title="Послать через email" aria-label="Послать через email" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.threads.net/intent/post?text=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/%20Project%20configuration.%20Part%201.%20Railsclub%20intro." title="Post on Threads" aria-label="Post on Threads" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M331.5 235.7c2.2.9 4.2 1.9 6.3 2.8 29.2 14.1 50.6 35.2 61.8 61.4 15.7 36.5 17.2 95.8-30.3 143.2-36.2 36.2-80.3 52.5-142.6 53h-.3c-70.2-.5-124.1-24.1-160.4-70.2-32.3-41-48.9-98.1-49.5-169.6V256v-.2C17 184.3 33.6 127.2 65.9 86.2 102.2 40.1 156.2 16.5 226.4 16h.3c70.3.5 124.9 24 162.3 69.9 18.4 22.7 32 50 40.6 81.7l-40.4 10.8c-7.1-25.8-17.8-47.8-32.2-65.4-29.2-35.8-73-54.2-130.5-54.6-57 .5-100.1 18.8-128.2 54.4C72.1 146.1 58.5 194.3 58 256c.5 61.7 14.1 109.9 40.3 143.3 28 35.6 71.2 53.9 128.2 54.4 51.4-.4 85.4-12.6 113.7-40.9 32.3-32.2 31.7-71.8 21.4-95.9-6.1-14.2-17.1-26-31.9-34.9-3.7 26.9-11.8 48.3-24.7 64.8-17.1 21.8-41.4 33.6-72.7 35.3-23.6 1.3-46.3-4.4-63.9-16-20.8-13.8-33-34.8-34.3-59.3-2.5-48.3 35.7-83 95.2-86.4 21.1-1.2 40.9-.3 59.2 2.8-2.4-14.8-7.3-26.6-14.6-35.2-10-11.7-25.6-17.7-46.2-17.8H227c-16.6.0-39 4.6-53.3 26.3l-34.4-23.6c19.2-29.1 50.3-45.1 87.8-45.1h.8c62.6.4 99.9 39.5 103.7 107.7l-.2.2zm-156 68.8c1.3 25.1 28.4 36.8 54.6 35.3 25.6-1.4 54.6-11.4 59.5-73.2-13.2-2.9-27.8-4.4-43.4-4.4-4.8.0-9.6.1-14.4.4-42.9 2.4-57.2 23.2-56.2 41.8l-.1.1z"/></svg>
</span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://telegram.me/share/url?text=https://zzet.org/ru/archive/2017-10-29-project-configuration-railsclub-intro/&amp;url=Project%20configuration.%20Part%201.%20Railsclub%20intro." title="Поделиться на Telegram" aria-label="Поделиться на Telegram" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></section><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=https://zzet.org/ru/archive/2014-03-28-lection-4-git-course-undev/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Git. Просто Git. Лекция 4. Git на сервере.</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2014-03-28 00:00:00 +0000 UTC">28 марта 2014 г.</time>
</span></span></a></span><span></span></div></div></footer></article></main><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12" id=to-top hidden=true><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=Вверх title=Вверх>&uarr;</a></div><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="group mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a href=/ru/archive/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Архив</span></a></li></ul></nav><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
Андрей Куманяев</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Работает на <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"></div></div></footer></div></body></html>