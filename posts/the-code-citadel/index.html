<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>The Code Citadel - The Architectural Codex &#183; Andrey Kumanyaev</title><meta name=title content="The Code Citadel - The Architectural Codex &#183; Andrey Kumanyaev"><script type=text/javascript src=https://zzet.org/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=https://zzet.org/css/main.bundle.min.100caa677b4bc416cdd884107b203b4869f9b413a19aa57d12069fb826f1abe9.css integrity="sha256-EAyqZ3tLxBbN2IQQeyA7SGn5tBOhmqV9EgafuCbxq+k="><meta name=description content="
      
        
      
    "><meta name=robots content="all"><link rel=canonical href=https://zzet.org/posts/the-code-citadel/><link rel=alternate type=application/rss+xml href=https://zzet.org/posts/the-code-citadel/index.xml title="Andrey Kumanyaev"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://zzet.org/posts/the-code-citadel/"><meta property="og:site_name" content="Andrey Kumanyaev"><meta property="og:title" content="The Code Citadel - The Architectural Codex"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="The Code Citadel - The Architectural Codex"><meta name=author content="Andrey Kumanyaev"><link href=https://github.com/zzet rel=me><link href=https://x.com/zzetorg rel=me><link href=https://www.reddit.com/user/zzet/ rel=me><link href=https://www.linkedin.com/in/andrey-kumanyaev/ rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-VGXR3BQCTQ"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VGXR3BQCTQ")}</script></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Andrey Kumanyaev</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/about/ title=About><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=https://github.com/zzet title target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=https://x.com/zzetorg title target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><header><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=https://zzet.org/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=https://zzet.org/posts/>posts</a><span class="px-1 text-primary-500">/</span></li><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=https://zzet.org/posts/the-code-citadel/>The Code Citadel - The Architectural Codex</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">The Code Citadel - The Architectural Codex</h1></header><section class="mt-12 prose flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc ps-5 lg:sticky lg:top-10"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-decline-of-the-fortress-the-monolith-as-the-castle-keep>The Decline of the Fortress: The Monolith as the Castle Keep</a><ul><li><a href=#the-majestic-monolith-and-the-centralized-keep>The Majestic Monolith and the Centralized Keep</a></li><li><a href=#the-transition-to-the-bastide-planned-vs-organic-decomposition>The Transition to the Bastide: Planned vs. Organic Decomposition</a></li></ul></li><li><a href=#infrastructure-of-the-sprawl-the-fallacies-of-the-road>Infrastructure of the Sprawl: The Fallacies of the Road</a><ul><li><a href=#the-network-as-the-muddy-road>The Network as the Muddy Road</a></li><li><a href=#synchronous-couriers-vs-asynchronous-pigeons>Synchronous Couriers vs. Asynchronous Pigeons</a></li></ul></li><li><a href=#the-crisis-of-consistency-the-two-generals-and-the-ledger>The Crisis of Consistency: The Two Generals and the Ledger</a><ul><li><a href=#the-fragmentation-of-truth>The Fragmentation of Truth</a></li><li><a href=#the-consensus-dilemma-two-generals-problem>The Consensus Dilemma (Two Generals Problem)</a></li><li><a href=#managing-the-trade-2pc-vs-sagas>Managing the Trade: 2PC vs. Sagas</a></li></ul></li><li><a href=#defense-hygiene-and-governance>Defense, Hygiene, and Governance</a><ul><li><a href=#the-great-fire-and-the-circuit-breaker>The Great Fire and the Circuit Breaker</a></li><li><a href=#quarantine-and-the-bulkhead>Quarantine and the Bulkhead</a></li><li><a href=#the-city-gates-zero-trust-and-the-api-gateway>The City Gates: Zero Trust and The API Gateway</a></li><li><a href=#the-royal-inspectors-consumer-driven-contracts>The Royal Inspectors: Consumer-Driven Contracts</a></li></ul></li></ul></nav></div></details></div></div><div class="min-h-0 min-w-0 max-w-prose grow"><h2 id=the-decline-of-the-fortress-the-monolith-as-the-castle-keep class="relative group">The Decline of the Fortress: The Monolith as the Castle Keep <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-decline-of-the-fortress-the-monolith-as-the-castle-keep aria-label=Anchor>#</a></span></h2><h3 id=the-majestic-monolith-and-the-centralized-keep class="relative group">The Majestic Monolith and the Centralized Keep <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-majestic-monolith-and-the-centralized-keep aria-label=Anchor>#</a></span></h3><p>The software industry has long engaged in a debate regarding the efficacy of monolithic architectures versus distributed systems. The &ldquo;Majestic Monolith,&rdquo; a term championed by advocates of unified codebases, finds its perfect historical analogue in the medieval Castle Keep. The Keep was a masterpiece of defensive efficiency and centralized governance. Structurally, it represents a single deployment unit where the user interface, business logic, and data access layers reside within a unified perimeter, sharing the same resources (memory and CPU) just as the castle inhabitants shared the Great Hall and the Bailey.</p><p>The primary advantage of the Keep was its simplicity in governance and defense. A single Castellan (the administrator) could oversee the entire operation. Communication was instantaneous; a command whispered in the solar was heard in the great hall without delay, mirroring the efficiency of Inter-Process Communication (IPC) where latency is effectively zero. Resources, while finite, were pooled. The castle well and the granary served all inhabitants, analogous to a single, massive relational database (RDBMS) ensuring strict ACID transactional consistency across all domains. In this environment, the &ldquo;Royal Truth&rdquo; of the ledger was absolute; there was no ambiguity about the state of the kingdom&rsquo;s finances, as all transactions occurred within a single, locked vault.</p><p>However, the historical trajectory of the medieval fortress reveals the inherent limitations of this model. As the population within the walls grew, the Keep suffered from severe overcrowding. In software terms, this is &ldquo;development sprawl&rdquo;. When hundreds of developers attempt to commit code to a single repository, they become like servants tripping over one another in a crowded scullery. The &ldquo;fear of the deploy&rdquo; grows; updating a single library is akin to renovating the castle foundations—a high-risk operation that requires evacuating the entire structure (downtime) to prevent collapse.</p><h3 id=the-transition-to-the-bastide-planned-vs-organic-decomposition class="relative group">The Transition to the Bastide: Planned vs. Organic Decomposition <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-transition-to-the-bastide-planned-vs-organic-decomposition aria-label=Anchor>#</a></span></h3><p>The transition from a Monolith to Microservices mirrors the historical shift from the autarkic fortress to the networked city or the &ldquo;Bastide.&rdquo; Bastides were planned towns established in medieval France (13th–14th centuries) designed with regular grid plans and specialized districts, often founded on trade routes rather than purely for defense.</p><p>This distinction is crucial for understanding the &ldquo;Greenfield&rdquo; versus &ldquo;Brownfield&rdquo; approaches to microservices. A &ldquo;Greenfield&rdquo; project is a Bastide - a city planned from scratch with clear boundaries and zoning laws (domain-driven design). Conversely, decomposing an existing monolith is more akin to the &ldquo;Strangler Fig&rdquo; pattern, where the new city slowly grows around and eventually replaces the old castle.</p><p>The research indicates that the primary pain point in this transition is the loss of centralized control. In the Castle, the King’s word was law. In the City, governance is federated. The Blacksmiths&rsquo; Guild (Inventory Service) and the Bakers&rsquo; Guild (Order Service) operate with high autonomy, setting their own internal rules (encapsulation). While this autonomy allows the Blacksmiths to adopt new tools (technology diversity) without consulting the Bakers, it introduces the &ldquo;Pain of Federation&rdquo;. The city requires a complex bureaucracy to ensure these independent guilds work in concert, mirroring the operational complexity (DevOps overhead) that plagues microservice adopters.</p><h2 id=infrastructure-of-the-sprawl-the-fallacies-of-the-road class="relative group">Infrastructure of the Sprawl: The Fallacies of the Road <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#infrastructure-of-the-sprawl-the-fallacies-of-the-road aria-label=Anchor>#</a></span></h2><h3 id=the-network-as-the-muddy-road class="relative group">The Network as the Muddy Road <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-network-as-the-muddy-road aria-label=Anchor>#</a></span></h3><p>The most profound shift in the move to a distributed &ldquo;City&rdquo; architecture is the change in communication medium. Inside the Castle (Monolith), communication was via function calls—instant, reliable, and invisible. In the City (Microservices), communication occurs over the network. The &ldquo;Fallacies of Distributed Computing,&rdquo; first identified by Peter Deutsch, warn against assuming the network is reliable, secure, or fast.</p><p>In our medieval analogy, the network is the road connecting the districts.</p><ul><li><strong>Latency is Zero (The Fallacy of Teleportation):</strong> In the castle, moving goods from the cellar to the kitchen took moments. In the city, sending goods from the Docks to the Market takes time. The roads are often muddy (high latency) or congested with ox-carts (bandwidth limits). If a business process requires sequential visits to five different guilds—a &ldquo;chattiness&rdquo; often found in poorly designed systems—the cumulative travel time can paralyze the transaction. This is the &ldquo;N+1 Select&rdquo; problem manifested as a logistical nightmare.</li><li><strong>The Network is Reliable (The Fallacy of the Safe Passage):</strong> We assume the messenger sent to the neighboring village will arrive. But in the medieval landscape, messengers are waylaid by bandits (security breaches), delayed by storms (packet loss), or simply vanish. If a service sends a request and receives no reply, it enters a state of limbo, unsure if the message was delivered or lost. This necessitates the implementation of &ldquo;Timeouts&rdquo; (declaring the messenger dead after a set time) and &ldquo;Retries&rdquo; (sending a second messenger), which in turn complicates the system with idempotency requirements.</li></ul><h3 id=synchronous-couriers-vs-asynchronous-pigeons class="relative group">Synchronous Couriers vs. Asynchronous Pigeons <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#synchronous-couriers-vs-asynchronous-pigeons aria-label=Anchor>#</a></span></h3><p>The research identifies two primary modes of transport in this city, each with distinct trade-offs:</p><table><thead><tr><th><strong>Feature</strong></th><th><strong>Synchronous (REST/gRPC)</strong></th><th><strong>Asynchronous (Message Queues)</strong></th></tr></thead><tbody><tr><td><strong>Medieval Analogy</strong></td><td><strong>The Royal Courier</strong></td><td><strong>The Homing Pigeon</strong></td></tr><tr><td><strong>Mechanism</strong></td><td>The King sends a courier and <em>waits</em> for a return receipt before doing anything else.</td><td>The King attaches a message to a pigeon, releases it, and immediately returns to other work.</td></tr><tr><td><strong>Blocking</strong></td><td>Yes (Blocking Thread). The sender is idle while the courier travels.</td><td>No (Non-blocking). The sender is highly efficient.</td></tr><tr><td><strong>Coupling</strong></td><td>High. Both the Sender and Receiver must be awake and available simultaneously.</td><td>Low. The Receiver can be asleep; the pigeon waits in the coop (Queue).</td></tr><tr><td><strong>Failure Mode</strong></td><td>If the Receiver is down, the transaction fails immediately (404/503).</td><td>If the Receiver is down, the message persists in the Queue until recovery.</td></tr><tr><td><strong>Reliability</strong></td><td>Dependent on the &ldquo;Road&rdquo; conditions at that exact moment.</td><td>Dependent on the pigeon&rsquo;s instinct.</td></tr></tbody></table><p>The reliance on synchronous &ldquo;Couriers&rdquo; is a primary source of fragility in microservices. If the Order Service (Courier) must wait for the Inventory Service, and the Inventory Service is slow, the Order Service also becomes slow. This is &ldquo;cascading latency.&rdquo; The asynchronous &ldquo;Pigeon&rdquo; (Event-Driven Architecture) resolves this by decoupling the systems, but introduces the complexity of eventual consistency—the King does not know <em>when</em> the order was received.</p><h2 id=the-crisis-of-consistency-the-two-generals-and-the-ledger class="relative group">The Crisis of Consistency: The Two Generals and the Ledger <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-crisis-of-consistency-the-two-generals-and-the-ledger aria-label=Anchor>#</a></span></h2><h3 id=the-fragmentation-of-truth class="relative group">The Fragmentation of Truth <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-fragmentation-of-truth aria-label=Anchor>#</a></span></h3><p>In the Monolithic Castle, the &ldquo;Royal Truth&rdquo; was maintained in a single, ACID-compliant ledger (Database). In the Medieval City, every Guild maintains its own ledger. The Blacksmith records his iron stocks; the Treasurer records the gold. This leads to the most significant pain point in distributed systems: <strong>Data Consistency</strong>.</p><p>If a merchant pays the Treasurer for a sword, and the Treasurer sends a runner to the Blacksmith to release the sword, but the runner dies en route, the system is in an inconsistent state: the money is taken, but the goods are not delivered. This violates the atomicity guaranteed by the Monolith.</p><h3 id=the-consensus-dilemma-two-generals-problem class="relative group">The Consensus Dilemma (Two Generals Problem) <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-consensus-dilemma-two-generals-problem aria-label=Anchor>#</a></span></h3><p>The challenge of coordinating these distributed ledgers is mathematically represented by the &ldquo;Two Generals Problem&rdquo;. Two generals (services) separated by a hostile city (the network) must agree to attack (commit a transaction) at the exact same time. Since they can only communicate via unreliable messengers, they can never be 100% certain that the other side has agreed.</p><ul><li><strong>General A:</strong> &ldquo;Attack at dawn?&rdquo;</li><li><strong>General B:</strong> &ldquo;Yes. Dawn.&rdquo; (But did A get my reply?)</li><li><strong>General A:</strong> &ldquo;Got your reply.&rdquo; (But did B get my confirmation?)</li></ul><p>This infinite regress creates the impossibility of perfect distributed consensus without a central authority or complex algorithms.</p><h3 id=managing-the-trade-2pc-vs-sagas class="relative group">Managing the Trade: 2PC vs. Sagas <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#managing-the-trade-2pc-vs-sagas aria-label=Anchor>#</a></span></h3><p>To manage this, architects employ two main strategies, analogous to medieval trade protocols:</p><p><strong>1. The Royal Decree (Two-Phase Commit - 2PC):</strong>
This acts as a &ldquo;Synchronous Pattern&rdquo;. A Coordinator (The King) demands that all participants (Guilds) lock their resources simultaneously.</p><ul><li><em>Phase 1 (Prepare):</em> &ldquo;Can everyone commit to this trade? Lock your vaults.&rdquo;</li><li><em>Phase 2 (Commit):</em> &ldquo;Execute.&rdquo;</li></ul><p>While this provides strong consistency, it is fragile. If the King dies (Coordinator failure) or one Guild is slow, the entire city&rsquo;s economy freezes (blocking). It is the equivalent of a rigid feudal ceremony that cannot tolerate a single absentee.</p><p><strong>2. The Trade Route (The Saga Pattern):</strong>
This operates as an &ldquo;Asynchronous Pattern&rdquo;. Instead of one big transaction, the trade is broken into a sequence of local steps.</p><ul><li><em>Step 1:</em> Merchant buys wood (Transaction A).</li><li><em>Step 2:</em> Merchant buys iron (Transaction B).</li></ul><p>If Step 2 fails (out of iron), the system cannot &ldquo;rollback&rdquo; in the traditional sense. Instead, it must execute a <strong>Compensating Transaction</strong>: the Merchant must return to the wood seller and ask for a refund. Sagas prioritize availability over consistency (BASE over ACID), mimicking the fluid, messy reality of medieval commerce where deals could be unmade if conditions changed.</p><h2 id=defense-hygiene-and-governance class="relative group">Defense, Hygiene, and Governance <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#defense-hygiene-and-governance aria-label=Anchor>#</a></span></h2><h3 id=the-great-fire-and-the-circuit-breaker class="relative group">The Great Fire and the Circuit Breaker <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-great-fire-and-the-circuit-breaker aria-label=Anchor>#</a></span></h3><p>Medieval cities were notoriously flammable, with wooden structures built in close proximity. A fire in a bakery could consume the entire city - a &ldquo;cascading failure&rdquo;. The medieval solution was the &ldquo;Firebreak&rdquo; - deliberately demolishing or spacing houses to ensure a gap the flames could not cross.</p><p>In microservices, a failing service is the fire. If the Recommendation Service hangs, it consumes the thread pool of the API Gateway, eventually crashing the entry point. The <strong>Circuit Breaker</strong> pattern detects the heat (latency/errors) and &ldquo;opens the circuit,&rdquo; effectively severing the connection. This &ldquo;Fail Fast&rdquo; mechanism saves the wider city by sacrificing the connection to the burning district.</p><h3 id=quarantine-and-the-bulkhead class="relative group">Quarantine and the Bulkhead <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#quarantine-and-the-bulkhead aria-label=Anchor>#</a></span></h3><p>When the plague (a software bug or resource leak) struck a medieval district, the city gates to that sector were barred—a practice known as <strong>Quarantine</strong>. This is the <strong>Bulkhead</strong> pattern. By isolating the thread pools and resources of different services (districts), the system ensures that a crash in the &ldquo;Inventory District&rdquo; does not infect the &ldquo;User Profile District.&rdquo; The city survives even if one neighborhood falls silent.</p><h3 id=the-city-gates-zero-trust-and-the-api-gateway class="relative group">The City Gates: Zero Trust and The API Gateway <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-city-gates-zero-trust-and-the-api-gateway aria-label=Anchor>#</a></span></h3><p>The Castle relied on a single perimeter defense (the Moat). Once inside, a spy could roam freely. This is the &ldquo;Perimeter Security&rdquo; model. The Medieval City, however, is partitioned. The API Gateway functions as the <strong>City Gate and Customs House</strong>.</p><ul><li><strong>The Guard (Load Balancer):</strong> Directs the flow of traffic to prevent overcrowding in the market square.</li><li><strong>The Customs Officer (Authentication/Authorization):</strong> Demands papers (JWT Tokens) at the gate.</li><li><strong>Zero Trust:</strong> Modern security adopts the &ldquo;Zero Trust&rdquo; model, analogous to having guards not just at the main gate, but at the door of <em>every</em> guild hall. Just because you are in the city doesn&rsquo;t mean you can enter the Treasury.</li></ul><h3 id=the-royal-inspectors-consumer-driven-contracts class="relative group">The Royal Inspectors: Consumer-Driven Contracts <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-royal-inspectors-consumer-driven-contracts aria-label=Anchor>#</a></span></h3><p>Standardization was a massive challenge in the Middle Ages. A &ldquo;pound&rdquo; of grain in one town might weigh differently in the next. This chaos disrupted trade (integration failure). The solution was the Guild Inspector or Royal Standard, ensuring weights and measures were uniform.</p><p>In microservices, <strong>Consumer-Driven Contract (CDC)</strong> testing (e.g., Pact) fulfills this role. It ensures that the &ldquo;shape&rdquo; of the data (the standard bushel) expected by the Consumer matches what is produced by the Provider. If a Guild changes its standard without warning, the contract is broken, and the trade (build) is rejected</p></div></section><section class="prose mt-10 dark:prose-invert"><p class="border-t py-8"><em>There's no articles to list here yet.</em></p></section></main><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12" id=to-top hidden=true><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="group mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a href=/archive/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Archive</span></a></li></ul></nav><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
Andrey Kumanyaev</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"></div></div></footer></div></body></html>